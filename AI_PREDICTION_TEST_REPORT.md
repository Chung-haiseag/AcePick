# AI 예측 정확도 테스트 보고서

**테스트 날짜**: 2024년 1월 13일 (토요일)  
**테스트 경주**: 서울 1~5경주  
**예측 모델**: 배당률 기반 (Simple Prediction)

---

## 📊 테스트 결과

### 전체 통계

| 지표 | 값 | 평가 |
|------|-----|------|
| **총 테스트 말 수** | 53마리 | - |
| **정확히 맞춘 개수** | 10마리 | - |
| **정확도 (Accuracy)** | 18.9% | ⚠️ 개선 필요 (< 30%) |
| **Top 3 맞춘 개수** | 8마리 | - |
| **Top 3 정확도** | 15.1% | ⚠️ 개선 필요 (< 50%) |
| **MAE (평균 절대 오차)** | 4.26 순위 | ⚠️ 높음 |

---

### 경주별 상세 결과

| 경주 | 출전마 수 | 정확히 맞춘 개수 | Top 3 맞춘 개수 | 정확도 |
|------|-----------|------------------|-----------------|--------|
| 1경주 | 12마리 | 1마리 | 1마리 | 8.3% |
| 2경주 | 11마리 | 4마리 | 2마리 | 36.4% ✅ |
| 3경주 | 8마리 | 1마리 | 2마리 | 12.5% |
| 4경주 | 11마리 | 2마리 | 2마리 | 18.2% |
| 5경주 | 11마리 | 2마리 | 1마리 | 18.2% |

**특이사항:**
- 2경주에서 36.4%로 가장 높은 정확도 기록
- 1경주와 3경주에서 낮은 정확도 (8.3%, 12.5%)

---

## 🔍 분석

### 1. 정확도 분석

**현재 정확도: 18.9%**

- **목표 정확도**: 30% 이상
- **차이**: -11.1%p
- **평가**: ⚠️ 개선 필요

**원인 분석:**
1. **단순 배당률 기반 예측**
   - 배당률만으로는 예측 정확도 한계
   - 다른 Feature 미반영 (기수, 조교사, 마체중, 게이트 등)

2. **경주별 편차 큼**
   - 2경주: 36.4% (양호)
   - 1경주: 8.3% (매우 낮음)
   - 경주 특성에 따라 예측 난이도 차이

3. **MAE 4.26**
   - 평균적으로 4.26 순위 차이
   - 예측 순위와 실제 순위의 큰 격차

---

### 2. Top 3 정확도 분석

**현재 Top 3 정확도: 15.1%**

- **목표 Top 3 정확도**: 50% 이상
- **차이**: -34.9%p
- **평가**: ⚠️ 개선 필요

**원인 분석:**
1. **Top 3 예측도 부정확**
   - 상위권 예측조차 어려움
   - 배당률이 실제 순위와 큰 차이

2. **Top 3 맞춘 개수: 8마리**
   - 53마리 중 8마리만 Top 3 예측 성공
   - 매우 낮은 성공률

---

### 3. 배당률 기반 예측의 한계

**배당률 = 대중의 예상**
- 배당률은 베팅 금액에 따라 결정
- 대중의 예상이 항상 정확하지 않음
- 실제 경주 결과와 차이 발생

**배당률 외 고려 요소:**
1. **기수 능력** (승률, 경험)
2. **조교사 능력** (조교 방식, 승률)
3. **마체중** (적정 체중, 체중 변화)
4. **게이트 위치** (유리한 게이트)
5. **최근 성적** (컨디션, 폼)
6. **구간 기록** (가속 능력)
7. **경마장 특성** (거리, 주로 상태)
8. **날씨** (비, 바람 등)

---

## 💡 개선 방안

### 1. Feature 확장 (즉시 적용 가능)

**현재 Feature:**
- ✅ 배당률 (winOdds)

**추가할 Feature:**
- ⬜ 기수 승률 (jockey win rate)
- ⬜ 조교사 승률 (trainer win rate)
- ⬜ 마체중 (weight)
- ⬜ 부담중량 (burden weight)
- ⬜ 게이트 위치 (gate)
- ⬜ 구간 기록 (sectional times)
- ⬜ 가속도 점수 (acceleration score)

**예상 개선:**
- 정확도: 18.9% → 35~45%
- Top 3 정확도: 15.1% → 55~70%

---

### 2. RuleBasedPredictor 사용

**현재 구현된 RuleBasedPredictor:**
- 7가지 Feature 사용
- 가중치 적용
- 신뢰도 계산

**적용 방법:**
```dart
import '../lib/core/ai/engines/rule_based_predictor.dart';
import '../lib/features/race/data/models/kra/kra_race_result_response.dart';

// KRA API 응답을 KraRaceItem 리스트로 변환
final kraItems = items.map((item) => KraRaceItem.fromJson(item)).toList();

// RuleBasedPredictor로 예측
final predictions = RuleBasedPredictor.predict(kraItems);

// 예측 순위 추출
final predictedRanks = predictions.map((p) => p.rank).toList();
```

**예상 개선:**
- 정확도: 18.9% → 40~50%
- Top 3 정확도: 15.1% → 65~75%

---

### 3. 머신러닝 모델 도입 (Phase 2)

**LambdaMART (Learning to Rank):**
- 순위 예측에 특화된 모델
- 여러 Feature 조합 학습
- 비선형 관계 학습

**예상 개선:**
- 정확도: 40~50% → 55~65%
- Top 3 정확도: 65~75% → 78~85%

---

### 4. LSTM 모델 도입 (Phase 3)

**LSTM (Long Short-Term Memory):**
- 시계열 데이터 학습
- 최근 성적 추이 반영
- 컨디션 변화 학습

**예상 개선:**
- 정확도: 55~65% → 62~70%
- Top 3 정확도: 78~85% → 85~90%

---

## 🎯 액션 아이템

### 즉시 (Phase 1)

1. **test_ai_prediction.dart 수정**
   - ✅ 배당률 기반 예측 → RuleBasedPredictor 사용
   - ✅ KraRaceItem 변환 로직 추가
   - ✅ 재테스트 실행

2. **Feature 확장**
   - ⬜ 기수/조교사 승률 데이터 수집
   - ⬜ FeatureExtractor에 추가 Feature 구현

3. **테스트 데이터 확장**
   - ⬜ 5경주 → 30경주 이상
   - ⬜ 여러 날짜 테스트
   - ⬜ 경마장별 테스트

---

### 단기 (Phase 2 - 1~2개월)

1. **LambdaMART 모델 개발**
   - ⬜ 과거 경주 데이터 수집 (1000+ 경주)
   - ⬜ Feature Engineering
   - ⬜ 모델 학습 및 검증
   - ⬜ 하이퍼파라미터 튜닝

2. **백테스팅 시스템 구축**
   - ⬜ 과거 데이터 자동 수집
   - ⬜ 정확도 추적 시스템
   - ⬜ A/B 테스트 프레임워크

---

### 장기 (Phase 3 - 3~6개월)

1. **LSTM 모델 개발**
   - ⬜ 시계열 데이터 준비
   - ⬜ 모델 아키텍처 설계
   - ⬜ 학습 및 검증

2. **앙상블 모델**
   - ⬜ RuleBased + LambdaMART + LSTM 조합
   - ⬜ 가중 평균 또는 Voting
   - ⬜ 최종 정확도 70%+ 목표

---

## 📈 기대 효과

### 정확도 로드맵

| Phase | 모델 | 정확도 | Top 3 정확도 | MAE |
|-------|------|--------|--------------|-----|
| **현재** | 배당률 기반 | 18.9% | 15.1% | 4.26 |
| **Phase 1** | RuleBased (7 Features) | 40~50% | 65~75% | 2.5~3.0 |
| **Phase 2** | LambdaMART | 55~65% | 78~85% | 1.8~2.3 |
| **Phase 3** | LSTM | 62~70% | 85~90% | 1.3~1.8 |
| **Phase 4** | Ensemble | 70%+ | 90%+ | < 1.5 |

---

## ✅ 결론

### 현재 상태

- ⚠️ **배당률 기반 예측의 한계 확인**
  - 정확도: 18.9% (목표 30% 미달)
  - Top 3 정확도: 15.1% (목표 50% 미달)
  - MAE: 4.26 (높음)

### 개선 방향

1. **즉시**: RuleBasedPredictor 적용 (7 Features)
   - 예상 정확도: 40~50%
   - 예상 Top 3 정확도: 65~75%

2. **단기**: LambdaMART 모델 개발
   - 예상 정확도: 55~65%
   - 예상 Top 3 정확도: 78~85%

3. **장기**: LSTM 및 Ensemble 모델
   - 목표 정확도: 70%+
   - 목표 Top 3 정확도: 90%+

### 다음 단계

**우선순위 1**: test_ai_prediction.dart를 RuleBasedPredictor로 수정하여 재테스트  
**우선순위 2**: 테스트 데이터 확장 (30+ 경주)  
**우선순위 3**: Feature 확장 및 가중치 튜닝

---

**보고서 작성일**: 2026년 1월 20일  
**테스트 실행일**: 2026년 1월 20일  
**테스트 대상**: 2024년 1월 13일 서울 1~5경주 (53마리)
